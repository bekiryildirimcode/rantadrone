{% extends "base.html" %}

{% block title %}  İha Kirala {% endblock %}


{% block content %}
<section class="mt-3 mx-6" >
    <table id="rentedTable" class="display w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
        <tr>
            <th class="text-start">id</th>
            <th class="text-start">Model</th>
            <th class="text-start">Başlangıç Tarihi/Saat</th>
            <th class="text-start">Bitiş Tarihi/Saat</th>
            <th class="text-start">Actions</th>
        </tr>
        </thead>
    </table>
</section>



    <script>
        $(document).ready(function () {
            var table = $('#rentedTable').DataTable({
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": "{% url 'rented_data' %}",
                    "type": "GET"
                },
                "columns": [
                    {"data": 'id'},
                    {"data": 'image'},
                    {"data": 'start_date_and_time'},
                    {"data": 'end_date_and_time'},
                    {"data": 'action', "orderable": false}

                ]
            });

            $('#rentedTable').on('click', '.delete-btn', function () {
                var id = $(this).data('id');
                Swal.fire({
                    title: "Silmek istediğinize eminmisiniz.",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Evet"
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: '{% url "rented_action" 0 %}'.replace('0', id),
                            type: 'DELETE',
                            success: function (result) {
                                table.ajax.reload();
                                Swal.fire({
                                    title: "Silindi!",
                                    text: "Rezervasyon başarı ile kaldırıldı.",
                                    icon: "success"
                                });
                            }
                        });

                    }
                });
            });

            $('#rentedTable').on('click', '.edit-btn', function () {
                var id = $(this).data('id');
                $.get('{% url "rented_action" 0 %}'.replace('0', id), function (data) {
                    Swal.fire({
                        title: 'Güncelle',
                        html: `<label class="mb-2  block">Başlangıç Tarihi:</label>
                                    <input id="start_date" class=" w-56 mx-7 items-center "type="date"  value="${data.start_date}" >
                                    <label class="mb-2 block" >Başlangıç Saati:</label>
                                    <input id="start_time" class="w-24 mx-7 items-center" type="time"  value="${data.start_time}" >
                                    <label  class="mb-2 block" >Bitiş Tarihi:</label>
                                    <input id="end_date" class="w-56 mx-7 items-cente" type="date"  value="${data.end_date}" >
                                    <label  class="mb-2 block"  >Bitiş Saati:</label>
                                    <input id="end_time" class="w-24 mx-7 items-cente" type="time"  value="${data.end_time}" >`,
                        focusConfirm: false,
                        preConfirm: () => {
                            const start_date = document.getElementById('start_date').value;
                            const start_time = document.getElementById('start_time').value;
                            const end_date = document.getElementById('end_date').value;
                            const end_time = document.getElementById('end_time').value;
                            if (!start_date || !start_time || !end_time || !end_date) {
                                Swal.showValidationMessage('Boş Alan bırakmayınız');
                            } else {
                                //update with ajax
                                var data = {
                                    start_date,
                                    start_time,
                                    end_date,
                                    end_time,

                                };
                                $.ajax({
                                    url: '{% url "rented_action" 0 %}'.replace('0', id),
                                    type: 'PUT',
                                    contentType: 'application/json',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRFToken': '{{ csrf_token  }}'
                                    },
                                    data: JSON.stringify(data),
                                    success: function (result) {
                                        Swal.fire({
                                            title: "Güncellendi!",
                                            text: "Rezervasyon başarı ile güncellendi.",
                                            icon: "success"
                                        });
                                        table.ajax.reload();
                                    }
                                });

                            }
                        }
                    });

                });
            });


        });


    </script>

{% endblock %}

